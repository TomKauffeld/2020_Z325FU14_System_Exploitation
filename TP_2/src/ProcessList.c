#include "ProcessList.h"
#include <stdlib.h>

ProcessList* process_list_init()
{
	ProcessList* list = (ProcessList*)malloc(sizeof(ProcessList));
	if (list == NULL)
		return NULL;
	list->first = NULL;
	list->last = NULL;
	return list;
}

Bool process_list_push(ProcessList* list, Process* data)
{
	ProcessItem* item = (ProcessItem*)malloc(sizeof(ProcessItem));
	if (item == NULL)
		return FALSE;
	item->data = data;
	item->prev = list->last;
	item->next = NULL;
	if (list->last != NULL)
		list->last->next = item;
	list->last = item;
	if (list->first == NULL)
		list->first = item;
	return TRUE;
}

void process_list_remove(ProcessList* list, unsigned int id)
{
	ProcessItem* item = list->first;
	ProcessItem* next;
	while (item != NULL)
	{
		next = item->next;
		if (item->data->id == id)
		{
			if (item->prev == NULL)
				list->first = item->next;
			else
				item->prev->next = item->next;
			if (item->next == NULL)
				list->last = item->prev;
			else
				item->next->prev = item->prev;
			free(item);
		}
		item = next;
	}
}

Process* process_list_pop(ProcessList* list)
{
	ProcessItem* item = list->first;
	Process* data;
	if (item == NULL)
		return NULL;
	list->first = item->next;
	if (list->first == NULL)
		list->last = NULL;
	data = item->data;
	free(item);
	return data;
}

void process_list_destroy(ProcessList* list)
{
	ProcessItem* item = list->first;
	ProcessItem* next;
	while (item != NULL)
	{
		next = item->next;
		free(item);
		item = next;
	}
	free(list);
}
