#include "System.h"
#include "Process.h"
#include <stdlib.h>


void add_process(System* system, unsigned int parent_id, int max_children)
{
	int children, i, ins;
	Process* process = system_create_process(system, parent_id);
	ins = 10 + rand() % 20;
	for (i = 0; i < ins; i++)
	{
		Bool valid = is_true(rand() % 10 > 0);
		Bool block = is_true(rand() % 2 > 0);
		process_add_instruction(process, valid, block);
	}

	if (max_children < 1)
		return;
	children = rand() % (max_children + 1);
	for (i = 0; i < children; i++)
		add_process(system, process->id, max_children - 1);
}


int main()
{
	int i;
	System* system = system_init();

	for (i = 0; i < 10; i++)
		add_process(system, 0, 5);

	while (system_can_continue(system))
		system_step(system);

	system_destroy(system);
	return 0;
}